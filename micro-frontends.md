## 背景
当你用webpack搭了一个平台框架，有热更新，有别名，全局导入，用了很多加载器（如 sass-loader,babel-loader等）和自定义loader实现很多语法的支持，用了些插件可以自动拆分、合并、过滤、压缩代码最后自动导出，一切都觉得很美好，并开始投入使用。经过一两年的敏捷开发，平台功能和静态文件越来越多，这时候出现问题了

- 开发时首次运行需要好几min，修改一个小文件热更新需要小几十秒，效率低下

- 维护越来越麻烦，越来越笨重

- 当多项目并行时，容易引起各种代码冲突问题

- 只更改小部分代码时，也要构建和发布大量代码，容易导致其他问题

- 多团队很难拆分各自负责的模块，没有安全边际

## 方案
将该平台进行拆分成多个子应用放在同一个库中或者分库进行独立构建部署，每个团队各自负责自己的子应用，这样的话子应用之间相互影响较小，且可随意组合形成新的产品，也就是微前端架构，这种架构可以通过几种方式去实现， 并列出他们的缺点（ps:一些详细的思考我写在文章最后）

- 通过iframe实现多应用之间组合   
  
  `1. 应用之间数据的传输和同步阻碍较大  `

  `2. 有安全问题，如谷歌浏览器80之后对cookie的samesite限制等  `

  `3. 需要重复下载同样的依赖包  `

- 通过Web Components实现  
  
  `1. 浏览器支持度的话达到勉强可用`
  
- 将所需的异步模块设置为远程模块，由统一的js处理注入 
 
  `1. 需要将远程模块指出，构建时生成单独的模块文件`

## 实现
现在已经有较成熟的微前端框架了，如阿里的乾坤，在这里的话就不细说了，可以自行去官网看doc，这里主要讲述基于去年10月份发布的webpack5和single-spa去实现

federation主要用于对其他子应用暴露模块和共享依赖，single-spa主要用于跨framework（react,vue,andular），single-spa虽然也可以暴露模块，但是个人觉得registerApplication
注册应用的方式是直接异步引用其他子应用文件的，在构建时已经定死了，多个子应用会重复打包，在模块层面上没有完全分离各个子应用

ing:最近这一周才开始去搭建，现在已经实现了多包管理+模块暴露+共享依赖+跨framework应用+跨应用热更新，还有一些eslint格式验证+webpack构建优化+远程模块工厂没有时间去完成，后面会放到
=>https://github.com/nxt-hj/micro-frontends-demo

## 思考
* 从哪几个纬度去拆分子应用

  可以根据功能去划分，也可以按产品业务去划分，需要结合公司的状况和现有的框架体系
  
- 子应用之间该怎么实现样式隔离，防止污染

  1. 使用css module
  
  2. 使用sass的嵌套，在最外层添加父级类包裹
  
  3. 使用shadow dom

- 子应用在一个仓库好还是多个仓库好

  1. 平台不大，可以放在一个仓库中，这样的话不用重复安装依赖，好管理
  
  2. 平台大的话，建议分开，公用组件库可以单独拆出来作为远程引入模块，使用lerna进行多库管理和开发
